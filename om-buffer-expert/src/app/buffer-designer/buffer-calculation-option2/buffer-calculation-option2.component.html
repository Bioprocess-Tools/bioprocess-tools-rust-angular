<mat-card class="main-card-container">
  <form [formGroup]="bufferForm" (ngSubmit)="onSubmit()" class="formf">
    <div class="input">
      <mat-card class="autocomplete_input">
        <mat-form-field appearance="fill" class="rounded_input_om">
          <input
            matInput
            type="text"
            placeholder="Type first few letters to select buffer species"
            aria-label="Number"
            formControlName="bufferSpeciesControl"
            [matAutocomplete]="auto"
          />
          <mat-autocomplete
            #auto="matAutocomplete"
            (optionSelected)="onBufferSpeciesSelected($event)"
          >
            <mat-option
              *ngFor="let option of filteredBufferSpecies | async"
              [value]="option"
            >
              {{ option }}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </mat-card>
      <mat-form-field class="option1-full-width" appearance="fill">
        <mat-label class="bold-label">{{ buffer_label }} </mat-label>
        <mat-hint *ngIf="bufferForm.get('totalConcentration').errors?.['max'] "
          >Conc should be less than 0.4
        </mat-hint>
        <input
          matInput
          type="number"
          formControlName="totalConcentration"
          placeholder="total conc. of buffer species (M)"
          required
        />
      </mat-form-field>
      <mat-form-field class="option1-full-width" appearance="fill">
        <mat-label>Target pH</mat-label>
        <mat-hint
          *ngIf="bufferForm.get('target_pH').errors?.['max'] || bufferForm.get('target_pH').errors?.['min'] "
          >Conc should be between 3 and 10
        </mat-hint>
        <input matInput type="number" formControlName="target_pH" required />
      </mat-form-field>

      <mat-form-field class="option1-full-width" appearance="fill">
        <mat-label for="acidicCompound">Acidic Compound</mat-label>
        <mat-select
          id="acidicCompound"
          name="acidicCompound"
          ngDefaultControl
          formControlName="acidicCompound"
          required
        >
          <mat-option
            *ngFor="let compound of selectedAcidCompounds"
            [value]="compound"
          >
            {{ compound }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="option1-full-width" appearance="fill">
        <mat-label>Basic Compound</mat-label>
        <mat-select formControlName="basicCompound" required>
          <mat-option
            *ngFor="let compound of selectedBasicCompounds"
            [value]="compound"
          >
            {{ compound }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="option1-full-width" appearance="fill">
        <mat-label>Salt Compound</mat-label>
        <mat-select formControlName="saltCompound">
          <mat-option *ngFor="let compound of saltCompounds" [value]="compound">
            {{ compound }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="option1-full-width" appearance="fill">
        <mat-label>Salt Conc. (M) </mat-label>
        <mat-hint *ngIf="bufferForm.get('saltConcentration').errors?.['max']"
          >Conc should be less than 1
        </mat-hint>
        <input
          matInput
          type="number"
          formControlName="saltConcentration"
          placeholder="salt concentration"
        />
      </mat-form-field>
      <button
        class="wide-button"
        mat-raised-button
        color="accent"
        type="submit"
        [disabled]="bufferForm.invalid"
      >
        Get Buffer Design
      </button>
      <div *ngIf="bufferForm.hasError('invalidBufferSelection')">
        <p class="red_flag">
          Choose atleast one buffer species containing compound
        </p>
      </div>
    </div>
  </form>
  <mat-card class="summary">
    <mat-card class="solution-card" *ngIf="returnedSolution; else loadthis">
      <mat-card-header>
        <mat-card-title>{{ returnedSolution.name }}</mat-card-title>
        <mat-divider></mat-divider>
        <mat-card-subtitle>Buffer Composition Summary</mat-card-subtitle>
      </mat-card-header>
      <mat-divider></mat-divider>
      <mat-card-content
        *ngFor="
          let compound of returnedSolution.compound_concentrations | keyvalue
        "
      >
        <p class="less-space" mat-headline-1>
          {{ compound.key }} : {{ compound.value | number : "1.3-3" }}M
        </p>
        <mat-divider></mat-divider>
      </mat-card-content>
      <mat-divider></mat-divider>

      <h2 class="pH">pH : {{ returnedSolution.pH | number : "1.3-3" }}</h2>
    </mat-card>
    <mat-card
      class="message-card"
      *ngIf="returnedSolution && bufferForm.untouched == true"
    >
      <p
        class="red_flag"
        *ngIf="returnedSolution.result_flag['flag'] !== 'green'"
      >
        <span class="material-icons"> error </span>
        {{ "  " + returnedSolution.result_flag["comment"] }}
      </p>
      <p
        class="green_flag"
        *ngIf="returnedSolution.result_flag['flag'] == 'green'"
      >
        <span class="material-icons"> check_circle </span>
        &nbsp; Done!
      </p>
    </mat-card>

    <ng-template #loadthis>
      <mat-card class="example-card-holder"> </mat-card>
    </ng-template>
  </mat-card>
</mat-card>
