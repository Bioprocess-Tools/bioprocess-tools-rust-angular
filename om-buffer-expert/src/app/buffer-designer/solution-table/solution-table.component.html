<mat-card *ngIf="solution" class="card-background">
  <!-- <mat-card-title>Your solutions</mat-card-title> -->
  <mat-card class="grid-container">
    <mat-card
      class="grid-item"
      *ngFor="let solution of solutions; let i = index"
      [ngClass]="{
        'highlighted-card':
          solutions.length == 1 || selectedSolution === solution,
        'unhighlighted-card': selectedSolution == null
      }"
      (click)="viewDetails(solution, i, $event)"
    >
      <p class="scroll-title" [class.red-text]="solution.result_flag['flag'] === 'red'" #solutionElement>{{ solution.name }}</p>
      <div class="bottom-line">
        <p class="multi">{{solution.solution_type}}</p>
        <!-- <p class="solution_num">{{ i + 1 }} of {{ solutions.length }}</p> -->
        <button
          mat-icon-button
          class="delete-button"
          (click)="deleteSolution(solution,i)"
        >
          <mat-icon class="d_icon">delete</mat-icon>
        </button>
      </div>

    </mat-card>
  </mat-card>
</mat-card>

<mat-card class="solution_summary" *ngIf="solution">

  <mat-card-header>
    <h4 class="solution_title">{{ solution.name }}</h4>
  </mat-card-header>
  <mat-card-content
    *ngFor="let compound of solution.compound_concentrations | keyvalue"
  >
    <p class="less-space" mat-headline-1>
      {{ compound.key }} : {{ compound.value | number : "1.4-4" }}M
    </p>
    <mat-divider></mat-divider>
  </mat-card-content>
  <mat-card-content
    ><p class="pH">
      pH : {{ solution.pH | number : "1.3-3" }}
    </p></mat-card-content
  >
</mat-card>




<mat-card *ngIf="solution" class = "compound-cards">
  <mat-card class="compound-card" *ngFor="let compound of solution.compounds">
    <p class="compound_name">{{compound.name}}</p>
    <mat-card-content  class="ion-card-content">
      <p class="compound-mw">MW: {{compound.molecular_weight}}</p>
      <p class="compound-concs">Conc:  {{ solution.compound_concentrations[compound.name] | number: '1.4-4' }}M ({{ (solution.compound_concentrations[compound.name] * compound.molecular_weight) | number: '1.3-3' }} g/L)</p>
      <p class="ions-info">
  {{ compound.ions[0].name}} ({{ getIonConcentration(compound, 0) | number: '1.3-3' }}M)
  <ng-container *ngIf="compound.ions[1]">
    <br> {{ compound.ions[1].name}} ({{ getIonConcentration(compound, 1) | number: '1.3-3' }}M)
  </ng-container>
</p>
    </mat-card-content>
  </mat-card>
</mat-card>

<mat-card *ngIf="solution" class = "ion-cards">
  <mat-card class="ion-card-instance" *ngFor="let uion of solution.unique_ions">
    <p class="ion_names-title">{{uion.name}}</p>
    <mat-card-content class="ion-card-content">
     
      <div class="pka-grid-container">
          <div class="pka-names-label">pKa</div>
          <div class="pka-names" *ngFor="let pka of uion.pka"> {{ pka |number: '1.1-1'}} </div>
      </div>
      <div class="species-grid-container">
          <div class="ion-names-label">Charge</div>
            <div class="ion-names" *ngFor="let charge of getIonCharges(uion.highest_charge)" > {{ charge }} </div>
          <div class="ion-names-label">Conc.</div>
            <div class="ion-names" *ngFor="let conc of getIonicConcs(uion.ionic_concs_div_charge)"> {{ conc }} </div>
      </div>
      <div class = "conc-grid-container">
        <div class="pka-names-label">Total:</div>
        <div class="pka-names">{{ solution.ion_concentrations[uion.name] | number: '1.3-3' }}M</div>
      </div>
      </mat-card-content>
  </mat-card>
</mat-card>

<mat-card  class="heatmap" *ngIf="selectedSolution && getKeys(selectedSolution)" >
  <mat-card-title class="heatmap_title">Compositional Variability Heatmap</mat-card-title>
  <plotly-plot [data]="trace" [layout]="layout"></plotly-plot>
  
</mat-card>

