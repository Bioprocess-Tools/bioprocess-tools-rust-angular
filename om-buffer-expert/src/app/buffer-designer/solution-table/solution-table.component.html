<mat-card class="container">

<mat-card  class="card-background">

  <mat-card class="grid-container" *ngIf="solutions.length>0">


    <mat-card
      class="grid-item" 
      *ngFor="let solution of solutions; let i = index"
      [ngClass]="{
        'highlighted-card':
          solutions.length == 1 || selectedSolution === solution,
          'unhighlighted-card': selectedSolution !== null && selectedSolution !== solution
      }"
      (click)="viewDetails(solution, i, $event)"
    >
      <p class="scroll-title" [class.red-text]="solution.result_flag['flag'] === 'red'" #solutionElement >{{ solution.name }}</p>

      <div class="bottom-line">
        <p class="multi">{{solution.solution_type}}</p>

        <button
          mat-icon-button color='error'
          class="delete-button"
          (click)="deleteSolution(solution,i)"
        >
          <mat-icon  color='warn' class="d_icon">delete</mat-icon>
        </button>
      </div>

    </mat-card>
  </mat-card>
</mat-card>


<mat-card class="solution_summary" *ngIf="solution">
  <mat-card-header class="solution_title">
    <h4 >{{ solution.name }}</h4>
  </mat-card-header>
  <mat-card-content class="solution-content">
    <div class="compound-summary-grid" *ngFor="let compound of solution.compound_concentrations | keyvalue">
      <div class="summary-grid-label">{{ compound.key }}</div>
      <div class="summary-grid-value">{{ compound.value | number: "1.4-4" }}M</div>

    </div>
    <div class="compound-summary-grid-pH">


      <div class="summary-grid-label pH-label">
        <span class="pH_label_only">pH</span>
      </div>

      <div class="summary-grid-value pH-value">
        <span class="pH_value_only">{{ solution.pH | number: "1.3-3" }}</span>
      </div>


    </div>
  </mat-card-content>
</mat-card>

<mat-card class="compound-card-background">
<mat-card *ngIf="solution" class="compound-cards">
  <mat-card 
    class="compound-card" 
    *ngFor="let compound of solution.compounds; let i = index" 
    
  >

    <p class="compound_name">
      {{compound.name}}
    </p>


    <mat-card-content class="ion-card-content">
      <div class="compound-grid">
        <div class="grid-label">MW:</div>
        <div class="grid-value">{{compound.molecular_weight}}</div>
        <div class="grid-label">Conc:</div>
        <div class="grid-value">{{ solution.compound_concentrations[compound.name] | number: '1.4-4' }} M</div>
        <div class="grid-label">Conc:</div>
        <div class="grid-value">{{ (solution.compound_concentrations[compound.name] * compound.molecular_weight) | number: '1.3-3' }} g/L</div>
        <div class="grid-label">{{ compound.ions[0].name }} ion:</div>
        <div class="grid-value">{{ getIonConcentration(compound, 0) | number: '1.3-3' }} M</div>
        <ng-container *ngIf="compound.ions[1]">
          <div class="grid-label">{{ compound.ions[1].name }} ion:</div>
          <div class="grid-value">{{ getIonConcentration(compound, 1) | number: '1.3-3' }} M</div>
        </ng-container>
      </div>
    </mat-card-content>
  </mat-card>
</mat-card>















</mat-card>
<mat-card class="ion-card-background">
<mat-card *ngIf="solution" class = "ion-cards">

<mat-card class="ion-card-instance" *ngFor="let uion of solution.unique_ions; let i=index" >
      <p class="ion_names-title">{{uion.name}}</p> 
    <mat-card-content class="ion-card-content">
     
      <div class="pka-grid-container">
          <div class="pka-names-label">pKa</div>
          <div class="pka-names" *ngFor="let pka of uion.pka"> {{ pka |number: '1.1-1'}} </div>
      </div>
      <div class="species-grid-container">
          <div class="ion-names-label">Charge</div>
            <div class="ion-names" *ngFor="let charge of getIonCharges(uion.highest_charge)" > {{ charge }} </div>
          <div class="ion-names-label">Conc.</div>
            <div class="ion-names" *ngFor="let conc of getIonicConcs(uion.ionic_concs_div_charge)"> {{ conc }} </div>
      </div>
      <div class = "conc-grid-container">
        <div class="conc-names-label">Total:</div>
        <div class="conc-names">{{ solution.ion_concentrations[uion.name] | number: '1.3-3' }}M</div>
      </div>
      </mat-card-content>
  </mat-card>
</mat-card>
</mat-card>

<mat-card class="heatmap-background">
<mat-card  class="heatmap" *ngIf="selectedSolution && getKeys(selectedSolution)" >
  <mat-card-title class="heatmap_title mat-headline-5">Compositional Variability Heatmap</mat-card-title>
  <plotly-plot [data]="trace" [layout]="layout" [config] = "config"></plotly-plot>
  
</mat-card>
</mat-card>
</mat-card>
